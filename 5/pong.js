// Generated by CoffeeScript 1.6.3
/* (c) 2013 Maxim Litvinov*/(function(){var e,t,n,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},a=.03,f=1.04,l=.01,c=.07,h=.01,p=e=r=t=n=i=s=null,d=!0,v={left:0,right:0},m=80,g=50,y=function(){function t(e,t,n,r){this.x=e;this.y=t;this.w=n;this.h=r;if(this.w<0){this.x+=this.w;this.w=-this.w}if(this.h<0){this.y+=this.h;this.h=-this.h}}t.prototype.move=function(e,t){this.x=e;this.y=t};t.prototype.draw=function(){return e.strokeRect(i+this.x*n,s+this.y*n,this.w*n,this.h*n)};t.prototype.getRect=function(){return{x:this.x,y:this.y,w:this.w,h:this.h}};t.prototype.collides=function(e){return e.x<this.x+this.w&&e.y<this.y+this.h&&this.x<e.x+e.w&&this.y<e.y+e.h};return t}(),b=function(e){function t(e,n,r){this.x=e;this.y=n;r==null&&(r=1);t.__super__.constructor.call(this,this.x,this.y,1,1);this.speed={dx:r,dy:0}}u(t,e);return t}(y),w=function(e){function t(e,n,r){this.x=e;this.y=n;r==null&&(r=1);t.__super__.constructor.call(this,this.x,this.y,2*r,10)}u(t,e);return t}(y),E=function(e,t,n){return Math.min(Math.max(e,t),n)},S=function(){function o(){var e,t,n,r,i=this;this.reset();document.onmousemove=function(e){return i.move(e)};this.audio={};r=["left","right","wall","hit"];for(t=0,n=r.length;t<n;t++){e=r[t];this.audio[e]=new Audio("audio/"+e+".wav")}}o.prototype.reset=function(){this.score={left:0,right:0};delete this.left;delete this.right;delete this.ball;this.left=new w(0,0);this.right=new w(m,0,-1);this.ball=new b(m/2,g/2,-a);this.time=null;this.random_shift=0;return this.animate()};o.prototype.move=function(e){var t=$(p).offset(),r=(e.pageY-t.top-s)/n;return this.left.y=E(r,0,g-this.left.h)};o.prototype.animate=function(e){var t,n=this,r=e-this.time||0;this.time=e;t=new b(this.ball.x+this.ball.speed.dx*r,this.ball.y+this.ball.speed.dy*r);t.speed=this.ball.speed;this.random_shift=E(this.random_shift-l+Math.random()*2*l,0,1);if(this.ball.speed.dx>0){this.right.y+=Math.max(-c*r,Math.min(c*r,t.y-this.right.y+(t.h-this.right.h)*this.random_shift));this.right.y=E(this.right.y,0,g-this.left.h)}if(t.collides(this.left)){this.audio.left.play();this.ball.speed.dx=-this.ball.speed.dx*f;this.ball.speed.dy+=(t.y-this.left.y+(t.h-this.left.h)/2)*h}if(t.collides(this.right)){this.audio.right.play();this.ball.speed.dx=-this.ball.speed.dx*f;this.ball.speed.dy+=(t.y-this.right.y+(t.h-this.right.h)/2)*h}if(t.y<0||t.y+t.h>g){this.audio.wall.play();this.ball.speed.dy=-this.ball.speed.dy}t=null;this.ball.x+=this.ball.speed.dx*r;this.ball.y+=this.ball.speed.dy*r;this.draw();if(this.ball.x<0){this.audio.hit.play();this.score.right+=1;delete this.ball;this.ball=new b(m/2,g/2,-a)}if(this.ball.x+this.ball.w>m){this.audio.hit.play();this.score.left+=1;delete this.ball;this.ball=new b(m/2,g/2,a)}return window.requestAnimationFrame(function(e){return n.animate(e)})};o.prototype.draw=function(){e.clearRect(0,0,r,t);e.strokeRect(i,s,m*n,g*n);e.beginPath();e.moveTo(i+m*n/2,s);e.lineTo(i+m*n/2,s+g*n);typeof e.setLineDash=="function"&&e.setLineDash([5]);e.stroke();typeof e.setLineDash=="function"&&e.setLineDash([]);e.font="bold "+n*g*.2+"px sans-serif";e.textAlign="center";e.textBaseline="middle";e.strokeText(this.score.left,i+m*n*.4,s+g*n*.5);e.strokeText(this.score.right,i+m*n*.6,s+g*n*.5);this.left.draw();this.right.draw();return this.ball.draw()};return o}();$(function(){var o;p=document.getElementById("canvas");e=p.getContext("2d");e.translate(.5,.5);window.onresize=o=function(){r=p.width=p.offsetWidth;t=p.height=p.offsetHeight;n=Math.min(r/m,t/g)&-2;i=(r-n*m)/2|0;s=(t-n*g)/2|0;return console.log(r,t,n,i,s)};o();return new S})}).call(this);