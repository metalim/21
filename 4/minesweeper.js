// Generated by CoffeeScript 1.6.3
/* (c) 2013 Maxim Litvinov*/(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},t=20,n=20,r=.2,i=9,s=0,o=1,u=2,a=["#ffffff","#f7e0e0","#efc0c0","#e7a0a0","#df8080","#d76060","#cf4040","#c72020","#bf0000","#000000"],f=["white","lightgray","gold"];$(function(){var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=document.getElementById("canvas"),M=O.getContext("2d");M.translate(.5,.5);N=y=b=L=A=x=d=null;w=!0;k=!1;g=function(){w=!1;k=!1;return console.log("GAME OVER")};C=function(){w=!1;k=!0;return console.log("YOU WIN!")};E=function(){var e,u,a,f,l,c,h,p,v,m,g,y,b,E,T,N,C;x=function(){var e,o=[];for(h=e=0;0<=n?e<n:e>n;h=0<=n?++e:--e)o.push(function(){var e,n=[];for(c=e=0;0<=t?e<t:e>t;c=0<=t?++e:--e)n.push(Math.random()<=r?i:s);return n}());return o}();for(h=p=0,y=x.length;p<y;h=++p){l=x[h];for(c=v=0,b=l.length;v<b;c=++v){u=l[c];if(u===i)continue;e=0;for(f=m=E=h-1,T=h+1;E<=T?m<=T:m>=T;f=E<=T?++m:--m)if(0<=f&&f<n)for(a=g=N=c-1,C=c+1;N<=C?g<=C:g>=C;a=N<=C?++g:--g)0<=a&&a<t&&x[f][a]===i&&(e+=1);x[h][c]=e}}d=function(){var e,r=[];for(h=e=0;0<=n?e<n:e>n;h=0<=n?++e:--e)r.push(function(){var e,n=[];for(c=e=0;0<=t?e<t:e>t;c=0<=t?++e:--e)n.push(o);return n}());return r}();w=!0;return S()};v=function(){var e,r,o,u,l,c,h,p;M.clearRect(0,0,N,y);M.strokeStyle="black";M.lineWidth=1;M.strokeRect(L-1,A-1,b*t+2,b*n+2);if(x!=null)for(u=l=0,h=x.length;l<h;u=++l){r=x[u];for(o=c=0,p=r.length;c<p;o=++c){e=r[o];if(d[u][o]===s){M.lineWidth=1;M.strokeRect(L+o*b,A+u*b,b,b);if(s<e&&e<i){M.textAlign="center";M.textBaseline="middle";M.font="bold "+b/1.5+"px sans-serif";M.fillStyle=a[e];M.lineWidth=4;M.strokeText(e,L+o*b+b/2,A+u*b+b/2);M.fillText(e,L+o*b+b/2,A+u*b+b/2)}else if(e===i){M.beginPath();M.moveTo(L+o*b+.8*b,A+u*b+.5*b);M.arc(L+o*b+.5*b,A+u*b+.5*b,.3*b,0,2*Math.PI);M.fillStyle=a[i];M.fill()}}else{M.beginPath();M.rect(L+o*b,A+u*b,b,b);M.fillStyle=f[d[u][o]];M.fill();M.lineWidth=1;M.stroke()}}}if(!w){M.font="bold 300% sans-serif";M.lineWidth=2;M.textAlign="center";M.textBaseline="middle";if(k){M.strokeStyle="yellow";M.fillStyle="green";M.fillText("YOU WIN!",N/2,y/2);return M.strokeText("YOU WIN!",N/2,y/2)}M.strokeStyle="darkred";M.fillStyle="red";M.fillText("GAME OVER",N/2,y/2);return M.strokeText("GAME OVER",N/2,y/2)}};window.onresize=S=function(){N=O.width=O.offsetWidth;y=O.height=O.offsetHeight;b=Math.min(N/t,y/n)&-2;L=(N-b*t)/2|0;A=(y-b*n)/2|0;return v()};E();T=function(r,u){var a,f,l,c,h,p,v,m;if(e.call(function(){var e;p=[];for(e=0;0<=t?e<t:e>t;0<=t?e++:e--)p.push(e);return p}.apply(this),r)>=0&&e.call(function(){var e;v=[];for(e=0;0<=n?e<n:e>n;0<=n?e++:e--)v.push(e);return v}.apply(this),u)>=0&&d[u][r]===o){d[u][r]=s;if(x[u][r]===i)return g();if(x[u][r]===s){m=[];for(f=l=c=u-1,h=u+1;c<=h?l<=h:l>=h;f=c<=h?++l:--l)m.push(function(){var e,t,n,i=[];for(a=e=t=r-1,n=r+1;t<=n?e<=n:e>=n;a=t<=n?++e:--e)i.push(T(a,f));return i}());return m}}};m=function(r,i,a){var f,l;if(e.call(function(){var e;f=[];for(e=0;0<=t?e<t:e>t;0<=t?e++:e--)f.push(e);return f}.apply(this),r)>=0&&e.call(function(){var e;l=[];for(e=0;0<=n?e<n:e>n;0<=n?e++:e--)l.push(e);return l}.apply(this),i)>=0&&d[i][r]!==s)return a!=null?d[i][r]=a:d[i][r]^=o^u};h=function(r,i,o){var u,a,f,l,c,h,p,v,m,g,y=0;for(a=f=c=i-1,h=i+1;c<=h?f<=h:f>=h;a=c<=h?++f:--f)if(e.call(function(){var e;m=[];for(e=0;0<=n?e<n:e>n;0<=n?e++:e--)m.push(e);return m}.apply(this),a)>=0)for(u=l=p=r-1,v=r+1;p<=v?l<=v:l>=v;u=p<=v?++l:--l)e.call(function(){var e;g=[];for(e=0;0<=t?e<t:e>t;0<=t?e++:e--)g.push(e);return g}.apply(this),u)>=0&&(d[a][u]&o)!==s&&(y+=1);return y};p=function(e){var r,i,o,u,a=0;for(i=o=0;0<=n?o<n:o>n;i=0<=n?++o:--o)for(r=u=0;0<=t?u<t:u>t;r=0<=t?++u:--u)(d[i][r]&e)!==s&&(a+=1);console.log(a,e);return a};c=function(){var e,r,s,o,u=0;for(r=s=0;0<=n?s<n:s>n;r=0<=n?++s:--s)for(e=o=0;0<=t?o<t:o>t;e=0<=t?++o:--o)x[r][e]===i&&(u+=1);console.log(u);return u};return O.oncontextmenu=O.onclick=l=function(r){var i,a,f,l,g,y,S,N,k,M,_,D,P,H,B,j,F,I,q;if(!w){E();return}f=$(O).offset();l=Math.floor((r.pageX-f.left-L)/b);g=Math.floor((r.pageY-f.top-A)/b);if(e.call(function(){var e;I=[];for(e=0;0<=t?e<t:e>t;0<=t?e++:e--)I.push(e);return I}.apply(this),l)>=0&&e.call(function(){var e;q=[];for(e=0;0<=n?e<n:e>n;0<=n?e++:e--)q.push(e);return q}.apply(this),g)>=0)if(d[g][l]!==s)r.button===0?T(l,g):m(l,g);else if(d[g][l]===s&&x[g][l]!==s)if(r.button===0){if(h(l,g,u)===x[g][l])for(a=y=M=g-1,_=g+1;M<=_?y<=_:y>=_;a=M<=_?++y:--y)for(i=S=D=l-1,P=l+1;D<=P?S<=P:S>=P;i=D<=P?++S:--S)T(i,a)}else if(h(l,g,o|u)===x[g][l])for(a=N=H=g-1,B=g+1;H<=B?N<=B:N>=B;a=H<=B?++N:--N)for(i=k=j=l-1,F=l+1;j<=F?k<=F:k>=F;i=j<=F?++k:--k)m(i,a,u);p(o)===0&&p(u)===c()&&C();v();return!1}})}).call(this);