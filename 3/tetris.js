// Generated by CoffeeScript 1.6.3
/* (c) 2013 Maxim Litvinov*/(function(){var e=10,t=20,n=1e3,r=1.05,i=[[[0,0],[0,0]],[[1,1,1,1]],[[null,2,2],[2,2,null]],[[null,null,3],[3,3,3]],[[4,4,null],[null,4,4]],[[5,null,null],[5,5,5]],[[null,6,null],[6,6,6]]],s=["black","grey","darkred","red","darkblue","blue","darkgreen","green"];$(function(){var o,u,a,f,l,c,h,p,d,v,m=document.getElementById("canvas"),g=m.getContext("2d"),y=o=a=d=v=c=f=h=p=null,b=!0,w=function(){b=!1;g.font="bold 200% sans-serif";g.strokeStyle="darkred";g.fillStyle="red";g.textAlign="center";g.fillText("GAME OVER",y/2,o/2);g.strokeText("GAME OVER",y/2,o/2);return console.log("GAME OVER")},E=function(){f={x:4,y:0,shape:i[Math.random()*i.length|0]};A();return T(f.shape,f.x,f.y)?h=setTimeout(S,p):w()},S=function(){clearTimeout(h);h=null;return C(f.x,f.y+1)?h=setTimeout(S,p):k()},x=function(){var r,i;c=function(){var n,s=[];for(i=n=0;0<=t?n<t:n>t;i=0<=t?++n:--n)s.push(function(){var t,n=[];for(r=t=0;0<=e?t<e:t>e;r=0<=e?++t:--t)n.push(null);return n}());return s}();b=!0;p=n;l();return E()},T=function(n,r,i){var s,o,u,a,f,l,h,p;if(r<0||r+n[0].length>e||i+n.length>t)return!1;for(u=f=0,h=n.length;f<h;u=++f){a=n[u];if(i+u>=0)for(o=l=0,p=a.length;l<p;o=++l){s=a[o];if(s!=null&&c[i+u][r+o]!=null)return!1}}return!0},N=function(){var e,t,n=f.shape[0].length/2|0,r=f.shape.length/2|0,i=function(){var n=[];for(e in f.shape[0])n.push(function(){var n,r,i=[];for(t=n=r=f.shape.length-1;r<=0?n<=0:n>=0;t=r<=0?++n:--n)i.push(f.shape[t][e]);return i}());return n}(),s={x:f.x+n-r,y:f.y+r-n,shape:i};if(T(s.shape,s.x,s.y)){f=s;return A()}},C=function(e,t){if(T(f.shape,e,t)){f.x=e;f.y=t;return A()}},k=function(){var t,n,i,s,o,u,a,l,d,v,m,g,y,b,w,S,x,T,N;clearTimeout(h);h=null;while(C(f.x,f.y+1));N=f.shape;for(s=d=0,y=N.length;d<y;s=++d){u=N[s];if(f.y+s>=0)for(i=v=0,b=u.length;v<b;i=++v){t=u[i];t!=null&&(c[f.y+s][f.x+i]=t)}}for(l=m=0,w=c.length;m<w;l=++m){u=c[l];n=0;for(a=g=0,S=u.length;g<S;a=++g){t=u[a];t!=null&&(n+=1)}n===u.length&&(c[l]=null)}o=function(){var e,t,n=[];for(t=0,e=c.length;t<e;t++){u=c[t];u!=null&&n.push(u)}return n}();for(T=0,x=c.length;T<x;T++){u=c[T];if(u!=null)continue;o.unshift(function(){var t,n=[];for(a=t=0;0<=e?t<e:t>e;a=0<=e?++t:--t)n.push(null);return n}());p/=r}c=o;return E()},L=function(e,t,n){var r,i,o,u,f,l,c;g.strokeStyle="orange";c=[];for(o=f=0,l=n.length;f<l;o=++f){u=n[o];c.push(function(){var n,f,l=[];for(i=n=0,f=u.length;n<f;i=++n){r=u[i];if(r==null)continue;g.beginPath();g.fillStyle=s[r];g.rect(d+(i+e)*a,v+(o+t)*a,a,a);g.fill();l.push(g.stroke())}return l}())}return c},A=function(){var n,r,i,u,l,h,p,m;g.clearRect(0,0,y,o);g.strokeStyle="black";g.strokeRect(d-1,v-1,a*e+2,a*t+2);if(c!=null)for(u=l=0,p=c.length;l<p;u=++l){r=c[u];for(i=h=0,m=r.length;h<m;i=++h){n=r[i];if(n==null)continue;g.fillStyle=s[n];g.fillRect(d+i*a,v+u*a,a,a)}}if(f!=null)return L(f.x,f.y,f.shape)};window.onresize=l=function(){y=m.width=m.offsetWidth;o=m.height=m.offsetHeight;a=Math.min(y/e,o/t);d=(y-a*e)/2;v=(o-a*t)/2;return A()};x();return document.onkeydown=u=function(e){if(!b){x();return}if(e.keyCode===37)return C(f.x-1,f.y);if(e.keyCode===38)return N();if(e.keyCode===39)return C(f.x+1,f.y);if(e.keyCode===40)return k()}})}).call(this);